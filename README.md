# Сервис сокращения ссылок

Сервис для сокращения длинных URL с возможностью управления лимитом переходов и временем жизни ссылки.

## Основные возможности

- ✅ **Создание коротких ссылок** - преобразование длинных URL в короткие ссылки вида `clck.ru/XXXXXX`
- ✅ **Уникальные ссылки для каждого пользователя** - один и тот же URL для разных пользователей создает разные короткие ссылки
- ✅ **Лимит переходов** - пользователь может задать максимальное количество переходов по ссылке
- ✅ **Ограничение времени жизни** - пользователь может задать время жизни ссылки (в часах или днях)
- ✅ **Уведомления пользователя** - система уведомляет о недоступности ссылки (лимит исчерпан или срок истек)
- ✅ **Идентификация по UUID** - каждый пользователь идентифицируется уникальным UUID
- ✅ **Автоматическое открытие в браузере** - переход по короткой ссылке открывает оригинальный URL в браузере

## Требования

- Java 11 или выше

## Установка и запуск

1. Клонируйте репозиторий или скачайте проект
2. Откройте терминал в директории проекта
3. Скомпилируйте проект:
   ```bash
   javac -d target/classes -encoding UTF-8 -sourcepath src/main src/main/*.java src/main/model/*.java src/main/service/*.java src/main/util/*.java
   ```
   
   Или используйте скрипт (Windows):
   ```bash
   compile.bat
   ```

4. Запустите приложение:
   ```bash
   java -cp target/classes UrlShortenerApp
   ```
   
   Или используйте скрипты (Windows):
   - `compile_and_run.bat` - компиляция и запуск одной командой
   - `run.bat` - только запуск (если проект уже скомпилирован)

## Использование

### Основные команды меню

- `1` - Создать короткую ссылку
- `2` - Перейти по короткой ссылке
- `3` - Просмотреть мои ссылки
- `4` - Редактировать ссылку (изменить лимит переходов и время жизни)
- `5` - Удалить ссылку
- `6` - Показать мой User ID
- `7` - Установить User ID
- `0` - Выход

### Создание короткой ссылки

1. Выберите пункт меню `1. Создать короткую ссылку`
2. Введите длинный URL (например, `https://www.baeldung.com/java-9-http-client`)
3. Введите лимит переходов (или нажмите Enter для значения по умолчанию - 10)
4. Введите время жизни ссылки:
   - Формат: число + единица измерения
   - Примеры: `24ч`, `3д`, `12 часов`, `2 дня`, `48h`, `1d`
   - Единицы: `ч`/`час`/`часов`/`h`/`hour`/`hours` (часы) или `д`/`день`/`дней`/`d`/`day`/`days` (дни)
   - По умолчанию: 24 часа (если нажать Enter)
5. Система создаст уникальную короткую ссылку и покажет ваш User ID

**Важно:** Сохраните ваш User ID! Он нужен для доступа к вашим ссылкам в будущем.

### Переход по короткой ссылке

1. Выберите пункт меню `2. Перейти по короткой ссылке`
2. Введите короткую ссылку (например, `clck.ru/3DZHeG`)
3. Браузер автоматически откроется с оригинальным URL

**Примечание:** Если лимит переходов исчерпан или срок действия истек, вы получите уведомление.

### Просмотр своих ссылок

1. Выберите пункт меню `3. Просмотреть мои ссылки`
2. Убедитесь, что установлен правильный User ID (пункт меню `7`)

Вы увидите список всех ваших ссылок с подробной информацией:
- Оригинальный URL
- Количество переходов / Лимит
- Дата создания и истечения
- Статус (активна/недоступна)

### Редактирование ссылки

1. Выберите пункт меню `4. Редактировать ссылку`
2. Введите короткую ссылку для редактирования
3. Измените лимит переходов (или нажмите Enter, чтобы оставить без изменений)
4. Измените время жизни ссылки (или нажмите Enter, чтобы оставить без изменений)
5. При изменении параметров счетчик переходов будет сброшен

**Важно:** Редактировать ссылку может только её владелец.

### Удаление ссылки

1. Выберите пункт меню `5. Удалить ссылку`
2. Введите короткую ссылку для удаления
3. Ссылка будет удалена (только если вы являетесь её владельцем)

### Работа с User ID

- **Показать User ID**: пункт меню `6` - показывает ваш текущий User ID
- **Установить User ID**: пункт меню `7` - позволяет установить существующий User ID для доступа к ранее созданным ссылкам

**Важно:** User ID необходим для:
- Просмотра всех ваших ссылок
- Редактирования ссылок
- Удаления ссылок
- Управления ссылками в будущем

## Примеры использования

### Пример 1: Создание ссылки

```
Введите URL для сокращения: https://www.baeldung.com/java-9-http-client
Введите лимит переходов (или Enter для 10): 5
Введите время жизни ссылки (например: 24ч, 3д, 12 часов) или Enter для 24 часов: 2д

✅ Ссылка успешно создана!
Короткая ссылка: clck.ru/3DZHeG
Оригинальный URL: https://www.baeldung.com/java-9-http-client
Лимит переходов: 5
Срок действия: 2 дня
```

### Пример 2: Переход по ссылке

```
Введите короткую ссылку: clck.ru/3DZHeG
Переход на: https://www.baeldung.com/java-9-http-client
Открываю в браузере...
✅ Браузер открыт!
```

### Пример 3: Уведомление об исчерпании лимита

```
═══════════════════════════════════════
⚠️ УВЕДОМЛЕНИЕ
═══════════════════════════════════════
Короткая ссылка: clck.ru/3DZHeG
Оригинальный URL: https://www.baeldung.com/java-9-http-client
Причина: Лимит переходов исчерпан
Переходов использовано: 5 / 5
═══════════════════════════════════════
```

## Структура проекта

```
src/main/
├── model/
│   ├── Link.java          # Модель короткой ссылки
│   └── User.java          # Модель пользователя
├── service/
│   ├── LinkService.java   # Основной сервис для работы со ссылками
│   ├── ShortUrlGenerator.java  # Генератор коротких ссылок
│   └── StorageService.java     # Сервис сохранения/загрузки данных
├── util/
│   ├── BrowserOpener.java      # Утилита для открытия браузера
│   └── NotificationService.java # Сервис уведомлений
└── UrlShortenerApp.java   # Главное консольное приложение
```

## Особенности реализации

### Уникальность ссылок

Каждый пользователь получает уникальную короткую ссылку даже для одного и того же URL. Это достигается за счет:
- Использования UUID пользователя в генерации ссылки
- Комбинирования UUID и оригинального URL для создания уникального хеша

### Автоматическая очистка

Система автоматически удаляет просроченные ссылки каждую минуту. Время жизни ссылки задаётся пользователем при создании.

### Уведомления

Пользователь получает уведомления в следующих случаях:
- Лимит переходов исчерпан
- Срок действия ссылки истек
- Ссылка не найдена
- Попытка редактировать или удалить чужую ссылку

## Технические детали

- **Хранилище данных**: In-memory (ConcurrentHashMap) с автоматическим сохранением на диск
- **Сохранение данных**: Данные автоматически сохраняются в директорию `data/` при каждом изменении (создание/удаление ссылок, переходы)
- **Загрузка данных**: При запуске приложения данные автоматически загружаются с диска
- **Поток очистки**: Daemon thread, проверяет просроченные ссылки каждую минуту
- **Генерация ссылок**: Комбинация UUID пользователя, оригинального URL и случайных символов
- **Время жизни**: Настраивается пользователем при создании ссылки (по умолчанию 24 часа). Можно указать в часах или днях. Просроченные ссылки автоматически удаляются
- **Формат короткой ссылки**: `clck.ru/XXXXXX` (6 символов + префикс из UUID)

## Тестирование функциональности

### Тест 1: Уникальность ссылок для разных пользователей

1. Запустите приложение
2. Создайте ссылку для URL `https://example.com` (запомните User ID и короткую ссылку)
3. Выйдите из приложения (пункт `0`)
4. Запустите приложение снова
5. Установите другой User ID (пункт `7`, введите новый UUID)
6. Создайте ссылку для того же URL `https://example.com`
7. **Результат:** Должна быть создана другая короткая ссылка

### Тест 2: Лимит переходов

1. Создайте ссылку с лимитом переходов = 2
2. Перейдите по ссылке дважды (пункт `2`)
3. Попробуйте перейти в третий раз
4. **Результат:** Должно появиться уведомление "Лимит переходов исчерпан"

### Тест 3: Время жизни ссылки

1. Создайте ссылку с небольшим временем жизни (например, `1ч`)
2. Подождите истечения срока
3. Попробуйте перейти по ссылке
4. **Результат:** Должно появиться уведомление "Срок действия ссылки истек"

### Тест 4: Автоматическое открытие браузера

1. Создайте ссылку
2. Перейдите по ней (пункт `2`)
3. **Результат:** Браузер должен автоматически открыться с оригинальным URL

## Решение проблем

### Браузер не открывается автоматически

Если браузер не открывается автоматически, система покажет сообщение с URL, который можно открыть вручную.

### User ID потерян

Если вы потеряли User ID, вы не сможете получить доступ к ранее созданным ссылкам. Рекомендуется сохранять User ID в безопасном месте.

### Ссылка не найдена

Возможные причины:
- Ссылка была удалена
- Срок действия ссылки истек
- Неверно введена короткая ссылка